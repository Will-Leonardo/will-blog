---
title: ElementPlus组件源码学习
date: 2023-10-23
categories: 
 - ElementPlus
---
<Boxx type='tip' />


## ts 类型谓词 is 的用法

```js
export const isUndefined = (val: any): val is undefined => val === undefined
export const isBoolean = (val: any): val is boolean => typeof val === 'boolean'
export const isNumber = (val: any): val is number => typeof val === 'number'
```

上面这段代码是截取的源码的一小段代码，`val is undefined` 这种是什么写法呢？与我们较多使用的 `as` 有什么区别呢？ `is`操作符用于类型守卫，用于在运行时检查类型；`as`操作符用于类型断言，用于在编译时告诉编译器某个值的具体类型。

`is`：帮助我们实现自定义类型判断方法的**类型收窄**， 特别是非内置类型时需要；


举个🌰

```js
type Student = {
  id: string
  name: string
  classRoom: string
}

type Teacher = {
  id: string
  name: string
  officeRoom: string
}

type RoomMan = Student | Teacher

const isStudent = (person: RoomMan): person is Student => {
  return 'classRoom' in person
}
```

- is 的使用

```js
function isString(value: unknown): value is string {
  return typeof value === 'string';
}

function processValue(value: unknown) {
  if (isString(value)) {
    // 在这里，value被类型收窄为string类型
    console.log(value.toUpperCase());
  } else {
    console.log('Value is not a string');
  }
}

```

- as 的使用

```js
let value: unknown = 'Hello World';
let length: number = (value as string).length;
```

参考阅读：
- [ts 类型谓词 is 的用法](https://barwe.cc/2022/08/22/ts-is)
- [typescript 的 is 类型谓词有什么作用？](https://www.zhihu.com/question/560309372)

## avatar组件

`avatar` 组件使用 shape 和 size 属性来设置 Avatar 的形状和大小，支持使用图片，图标或者文字作为 Avatar

### srcset 

```html
<img
  v-if="(src || srcSet) && !hasLoadError"
  :src="src"
  :alt="alt"
  :srcset="srcSet"
  :style="fitStyle"
  @error="handleError"
/>
```

## backtop

返回页面顶部的操作按钮

```html
<transition :name="`${ns.namespace.value}-fade-in`">
  <div
    v-if="visible"
    :style="backTopStyle"
    :class="ns.b()"
    @click.stop="handleClick"
  >
    <slot>
      <el-icon :class="ns.e('icon')"><caret-top /></el-icon>
    </slot>
  </div>
</transition>
```

### transition组件

vue内置组件，支持name自定义过渡动画，这里使用的是 `el-fade-in` 动画

```css
.#{$namespace}-fade-in-enter-active,
.#{$namespace}-fade-in-leave-active {
  transition: all getCssVar('transition-duration') cubic-bezier(0.55, 0, 0.1, 1);
}
.#{$namespace}-fade-in-enter-from,
.#{$namespace}-fade-in-leave-active {
  opacity: 0;
}
```

![p1](https://cn.vuejs.org/assets/transition-classes.f0f7b3c9.png)


###  useBackTop

这是一个经典的vue3 的组合式api写法的案例，将数据和处理数据的一些逻辑分装在一个use函数中；

```ts {20}
<script lang="ts" setup>
import { computed } from 'vue'
import { ElIcon } from '@element-plus/components/icon'
import { CaretTop } from '@element-plus/icons-vue'
import { useNamespace } from '@element-plus/hooks'
import { backtopEmits, backtopProps } from './backtop'
import { useBackTop } from './use-backtop'

const COMPONENT_NAME = 'ElBacktop'

defineOptions({
  name: COMPONENT_NAME,
})

const props = defineProps(backtopProps)
const emit = defineEmits(backtopEmits)

const ns = useNamespace('backtop')

const { handleClick, visible } = useBackTop(props, emit, COMPONENT_NAME)

const backTopStyle = computed(() => ({
  right: `${props.right}px`,
  bottom: `${props.bottom}px`,
}))
</script>
```

### 