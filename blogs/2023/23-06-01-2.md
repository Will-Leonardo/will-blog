---
title: å‰ç«¯è·¯ç”±ç¯‡
date: 2023-06-01
categories: 
 - æ—¥å¸¸ç¬”è®°
---
<Boxx type='tip' />

## ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±ï¼Ÿ

å‰ç«¯è·¯ç”±æ˜¯æŒ‡åœ¨å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œé€šè¿‡JavaScriptå®ç°çš„ä¸€ç§<B>é¡µé¢è·³è½¬</B>æ–¹å¼ã€‚å®ƒå¯ä»¥åœ¨**ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢**çš„æƒ…å†µä¸‹ï¼Œæ”¹å˜URLå¹¶æ›´æ–°é¡µé¢å†…å®¹ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚å‰ç«¯è·¯ç”±é€šå¸¸ä½¿ç”¨æµè§ˆå™¨çš„**History APIæˆ–Hashï¼ˆ#ï¼‰**æ¥å®ç°ã€‚å…¶ä¸­ï¼Œ**History APIå¯ä»¥é€šè¿‡pushStateå’ŒreplaceStateæ–¹æ³•æ¥æ”¹å˜URL**ï¼Œè€Œ**Hashåˆ™æ˜¯é€šè¿‡window.location.hashå±æ€§æ¥å®ç°**ã€‚åœ¨ä½¿ç”¨å‰ç«¯è·¯ç”±æ—¶ï¼Œéœ€è¦æ³¨æ„é¡µé¢çš„SEOé—®é¢˜ï¼Œä»¥åŠæµè§ˆå™¨çš„å…¼å®¹æ€§ã€‚

## hashæ¨¡å¼

:strawberry: å‰ç½®çŸ¥è¯†ï¼š

1. URLæ˜¯ç”±å¾ˆå¤šéƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬åè®®ã€åŸŸåã€è·¯å¾„ã€queryã€hashç­‰, 

é¦–é¡µï¼šyourdomain.xxx.com/index.html/#/
å•†åŸï¼šyourdomain.xxx.com/index.html/#/shop
è´­ç‰©è½¦ï¼šyourdomain.xxx.com/index.html/#/shopping-cart
æˆ‘çš„ï¼šyourdomain.xxx.com/index.html/#/mine

#å·åé¢çš„ï¼Œå°±æ˜¯ä¸€ä¸ªURLä¸­å…³äºhashçš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸åŒè·¯ç”±å¯¹åº”çš„hashæ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯åœ¨è®¿é—®åŒä¸€ä¸ªé™æ€èµ„æºindex.html

```js {7,8}
<script>
  class VueRouter {
    constructor(routes  = []){
      this.routes = routes;
      this.curentHash = ''; // å½“å‰è·¯ç”±hash
      this.refresh = this.refresh.bind(this);
      window.addEventListener('load', this.refresh, false);
      window.addEventListener('hashchange', this.refresh, false);
    }

    getUrlHash(url){
      return url.indexOf('#') >= 0 ? url.slice(url.indexOf('#')+1) : '/'
    }
    refresh(event){
      this.curentHash =this.getUrlHash(window.location.hash);
      this.mathComponent();
    }
    mathComponent() {
      let curRoute = this.routes.find(route=> route.path === this.curentHash);
      if(!curRoute){
        curRoute === this.routes.find(route => route.path === '#/')
      }
      const { component } = curRoute;
      document.querySelector('#content').innerHTML = component;
    }
  }

  const route = new VueRouter([
    {
      path: '/',
      name: 'home',
      component: `<div>é¦–é¡µå†…å®¹<div>`
    },
    {
      path: '/shop',
      name: 'shop',
      component: `<div>å•†åŸå†…å®¹<div>`
    },
    {
      path: '/shopping-cart',
      name: 'shopping-cart',
      component: `<div>å•†åŸå†…å®¹<div>`
    },
    {
      path: '/mine',
      name: 'mine',
      component: `<div>æˆ‘çš„å†…å®¹<div>`
    }
  ])
</script>
```

## Historyæ¨¡å¼

:strawberry: å‰ç½®çŸ¥è¯†

historyå…¨å±€å¯¹è±¡

- window.history.go å¯ä»¥è·³è½¬åˆ°æµè§ˆå™¨ä¼šè¯å†å²ä¸­çš„æŒ‡å®šçš„æŸä¸€ä¸ªè®°å½•é¡µ
- window.history.forward æŒ‡å‘æµè§ˆå™¨ä¼šè¯å†å²ä¸­çš„ä¸‹ä¸€é¡µï¼Œè·Ÿæµè§ˆå™¨çš„å‰è¿›æŒ‰é’®ç›¸åŒ
- window.history.back è¿”å›æµè§ˆå™¨ä¼šè¯å†å²ä¸­çš„ä¸Šä¸€é¡µï¼Œè·Ÿæµè§ˆå™¨çš„å›é€€æŒ‰é’®åŠŸèƒ½ç›¸åŒ
- window.history.pushState å¯ä»¥å°†ç»™å®šçš„æ•°æ®å‹å…¥åˆ°æµè§ˆå™¨ä¼šè¯å†å²æ ˆä¸­
- window.history.replaceState å°†å½“å‰çš„ä¼šè¯é¡µé¢çš„urlæ›¿æ¢æˆæŒ‡å®šçš„æ•°æ®

è€Œhistoryè·¯ç”±çš„å®ç°ï¼Œä¸»è¦å°±æ˜¯ä¾é äº**pushStateä¸replaceState**å®ç°çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ€»ç»“ä¸‹å®ƒä»¬çš„ä¸€äº›ç‰¹ç‚¹

éƒ½ä¼šæ”¹å˜å½“å‰é¡µé¢æ˜¾ç¤ºçš„urlï¼Œä½†éƒ½ä¸ä¼šåˆ·æ–°é¡µé¢
pushStateæ˜¯å‹å…¥æµè§ˆå™¨çš„ä¼šè¯å†å²æ ˆä¸­ï¼Œä¼šä½¿å¾—history.lengthåŠ 1ï¼Œè€ŒreplaceStateæ˜¯æ›¿æ¢å½“å‰çš„è¿™æ¡ä¼šè¯å†å²ï¼Œå› æ­¤ä¸ä¼šå¢åŠ history.length

```js
class VueRouter {
  constructor(options) {
    this.routes = options.routes;
    this.mode = options.mode || 'hash';
    this.history = [];
    this.current = null;
    this.init();
  }

  init() {
    if (this.mode === 'hash') {
      window.addEventListener('hashchange', this.hashChange.bind(this));
      this.hashChange();
    } else {
      window.addEventListener('popstate', this.popstateChange.bind(this));
      this.popstateChange();
    }
  }

  hashChange() {
    const hash = window.location.hash.slice(1);
    this.history.push(hash);
    this.current = hash;
    this.render();
  }

  popstateChange() {
    const path = window.location.pathname;
    this.history.push(path);
    this.current = path;
    this.render();
  }

  render() {
    const route = this.routes.find(route => route.path === this.current);
    if (route) {
      document.querySelector('#app').innerHTML = route.component;
    }
  }
}

```

**é‡è¦ï¼š**

hashæ¨¡å¼æ˜¯ä¸éœ€è¦åç«¯æœåŠ¡é…åˆçš„ã€‚ä½†æ˜¯historyæ¨¡å¼ä¸‹ï¼Œå¦‚æœä½ å†è·³è½¬è·¯ç”±åå†æ¬¡åˆ·æ–°ä¼šå¾—åˆ°404çš„é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯è¯´ç™½äº†å°±æ˜¯æµè§ˆå™¨ä¼šæŠŠæ•´ä¸ªåœ°å€å½“æˆä¸€ä¸ªå¯è®¿é—®çš„é™æ€èµ„æºè·¯å¾„è¿›è¡Œè®¿é—®ï¼Œç„¶åæœåŠ¡ç«¯å¹¶æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï½çœ‹ä¸‹é¢ä¾‹å­æ›´å¥½ç†è§£

```js
http://192.168.30.161:5500/ === http://192.168.30.161:5500/index.html // é»˜è®¤è®¿é—®è·¯å¾„ä¸‹çš„index.htmlæ–‡ä»¶ï¼Œæ²¡æ¯›ç—…
http://192.168.30.161:5500/home === http://192.168.30.161:5500/index.html // ä»ç„¶è®¿é—®è·¯å¾„ä¸‹çš„index.htmlæ–‡ä»¶ï¼Œæ²¡æ¯›ç—…
...
http://192.168.30.161:5500/mine === http://192.168.30.161:5500/index.html // æ‰€æœ‰çš„è·¯ç”±éƒ½æ˜¯è®¿é—®è·¯å¾„ä¸‹çš„index.htmlï¼Œæ²¡æ¯›ç—…

```

```js
http://192.168.30.161:5500/mine === http://192.168.30.161:5500/mine/index.htmlæ–‡ä»¶ï¼Œå‡ºé—®é¢˜äº†ï¼ŒæœåŠ¡å™¨ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªèµ„æºï¼Œ404ğŸ˜­

```

æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦é…ç½®ä¸‹nginxï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬è®¿é—®çš„è·¯å¾„èµ„æºä¸å­˜åœ¨çš„æ—¶å€™ï¼Œé»˜è®¤æŒ‡å‘é™æ€èµ„æºindex.html

```js
location / {
  try_files $uri $uri/ /index.html;
}
```

å‚è€ƒæ–‡ç« 

- [é¢è¯•å®˜ä¸ºå•¥æ€»æ˜¯å–œæ¬¢é—®å‰ç«¯è·¯ç”±å®ç°æ–¹å¼ï¼Ÿ](https://juejin.cn/post/7127143415879303204#heading-2)