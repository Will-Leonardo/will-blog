---
title:  Vite
date: 2021-7-21
categories: 
 - Vite
---
<Boxx type='tip' />

## Vite的特点
1. 冷启动， 不打包 利用ES6 import
2. 开发时，热更新
3. 按需编译，不会刷新全部DOM。

## 新建项目

1. 新建项目
```
npm init vite-app pro-name
```
2. 加载依赖

```
npm install
```

3. 启动项目

```
npm run dev
```

## 注意
1. 只支持 Vue3 不支持 Vue2


## 背景

### 为什么需要构建工具？

最早的js代码只是简单的堆叠在一起，只要能从上往下依次执行就可以了，但是随着代码量的增加，逻辑也变的更加的复杂，js中就慢慢诞生了**模块化**的思想。


**模块化**可以帮助我们更好地解决复杂应用开发过程中的代码组织问题， 在js模块化的推进过程中，也衍生了许多规范， 例如**AMD，CMD， ESM**等。


![alt](https://img14.360buyimg.com/imagetools/jfs/t1/183919/8/27000/14982/62c43b31E9a57de43/389751fd200c25e9.webp)

但是，随着模块化的引入， 在生产环境中， 有**环境兼容、模块文件过多、频繁发送请求**等问题

### 发展中的构建工具

近些年前端工程化发展迅速，各种构建工具层出不穷，目前Webpack仍然占据统治地位，npm 每周下载量达到两千多万次。

![alt](https://img13.360buyimg.com/imagetools/jfs/t1/202244/2/25024/83057/62c43d67E9639352d/e5db84722580957b.png)

### webpack的痛点

![alt](https://img11.360buyimg.com/imagetools/jfs/t1/192345/26/26295/621798/62c43e8eE290b2580/5cbefd4363f94f44.png)


> **缓慢的开发环境，大大降低了开发者的幸福感，在以上背景下Vite应运而生。**

## 什么是Vite？

基于esbuild与Rollup，依靠浏览器自身ESM编译功能，是一种新型前端构建工具，能够显著提升前端开发体验

### 概念
Vite 通过在一开始将应用中的模块区分为<u>依赖</u>和 <u>源码</u> 两类，改进了开发服务器启动时间
- 依赖：  指开发不会变动的部分(npm包、UI组件库)，esbuild进行预构建。
- 源码：  浏览器不能直接执行的非js代码(.jsx、.css、.vue等)，vite只在浏览器请求相关源码的时候进行转换，以提供ESM源码。

### 开发环境

- 利用浏览器原生的ES Module编译能力，省略费时的编译环节，直给浏览器开发环境源码，dev server只提供轻量服务。
- 浏览器执行ESM的import时，会向dev server发起该模块的ajax请求，服务器对源码做简单处理后返回给浏览器。
- Vite中HMR是在原生 ESM 上执行的。当编辑一个文件时，Vite 只需要精确地使已编辑的模块失活，使得无论应用大小如何，HMR 始终能保持快速更新。
- 使用esbuild处理项目依赖，esbuild使用go编写，比一般node.js编写的编译器快几个数量级。

### 生产环境

- 集成Rollup打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制。

### 原理分析

与Webpack-dev-server类似Vite同样使用WebSocket与客户端建立连接，实现热更新，源码实现基本可分为两部分，源码位置在:

vite/packages/vite/src/client client（用于客户端）
vite/packages/vite/src/node server（用于开发服务器）

client 代码会在启动服务时注入到客户端，用于客户端对于WebSocket消息的处理（如更新页面某个模块、刷新页面）

server 代码是服务端逻辑，用于处理代码的构建与页面模块的请求。


![alt](https://img11.360buyimg.com/imagetools/jfs/t1/179635/13/26759/1253247/62c440b7E1e057a01/8451dc78abab0f94.png)



### 创建Vite项目

![alt](https://img13.360buyimg.com/imagetools/jfs/t1/215080/22/19947/290775/62c4410eEd0d5521a/c6cec8e218aa6bed.png)



### 插件系统

vite Rollup plugins:
https://vite-rollup-plugins.patak.dev/ 

社区插件列表:
https://github.com/vitejs/awesome-vite#plugins 

**使用：**

![alt](https://img14.360buyimg.com/imagetools/jfs/t1/1784/28/19238/445813/62c44246E124fc096/e9e32bdb5a775b96.png)


### 同时兼容webpack 和Vite

推荐使用插件：
通过使用下列插件可以轻松使你的项目同时兼容webpack 和Vite

webpack-to-vite：
https://github.com/originjs/webpack-to-vite

wp2vite：
https://github.com/tnfe/wp2vite




