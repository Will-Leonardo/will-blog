---
title:  js-cookie
date: 2021-1-28
tags:
 - cookies

categories: 
 - 工具js库
---

<Boxx type = 'tips' />

## 什么是cookie？
Cookie 就是一些key/value 数据，存储于你的电脑文本文件中。   

### 为什么需要cookie？
当web服务器向浏览器发送web页面时，在连接关闭后，服务端不会记录用户的信息，这样每次获取用户信息都需要
发送请求，一些长时间不改变的信息也要重新获取，这就不利于网站的性能。        
:dolphin: cookie 的作用就是存储部分信息在本地，例如存储用户名和密码来实现自动登录(不安全)，现在一般使用cookie来存储Token(由服务器生成的一段字符串)


## javaScript Cookie
[推荐阅读](https://www.runoob.com/js/js-cookies.html)
- 创建Cookie    
在浏览器的检查的Application中的Cookie中能找到我们存储的数据
```js
document.cookie = 'username=will wang'
```
- 添加过期时间 expires
可以为Cookie添加一个过期时间(UTC或者CMT)，默认情况下，Cookie在浏览器关闭时删除
```js
document.cookie="username=John Doe; expires=Thu, 18 Dec 2043 12:00:00 GMT";
```

- 读取cookie
```js
var cookies = document.cookie
console.log(typeof cookies) // string
console.log(cookies) //  username=will wang; password=123456
```
- 修改cookie
```js
document.cookie = 'username=luoliu'
```

- 删除
```js
document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 GMT";
```
:strawberry: UTC和CMT
> UTC （世界标准时间） CMT（格林尼治时间）

### :fish: 封装成方法
setCookie 参数：key、value、time
```js {1,6}
function setCookie(cname,cvalue,exdays)
{
  var d = new Date();
  d.setTime(d.getTime()+(exdays*24*60*60*1000));
  var expires = "expires="+d.toGMTString();
  document.cookie = cname + "=" + cvalue + "; " + expires;
}
```
getCookie 参数：key
```js
function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}
```

## js-cookie
js-cookie是一个简单的，轻量级的处理cookies的js API。 使用js-cookie能更简单的操作cookie。
- 安装
```
npm isntall --save js-cookie
```

- 添加
使用时记得引入 ```import Cookies from 'js-cookie'```
```js
// 创建一个名称为name，对应值为value的cookie，由于没有设置失效时间，默认失效时间为该网站关闭时
Cookies.set(name, value)

// 创建一个有效时间为7天的cookie
Cookies.set(name, value, { expires: 7 })

// 创建一个带有路径的cookie
Cookies.set(name, value, { path: '' })

// 创建一个value为对象的cookie
const obj = { name: 'ryan' }
Cookies.set('user', obj)

```

:fish: **注意：**   
1，即使添加时的value值类型为number，添加后获取到的value值的类型会被转换成string类型。      
2，如果没有设置cookie的失效时间，默认就是该网站关闭时cookie失效。

- 获取
```js
// 获取指定名称的cookie
Cookies.get(name) // value
Cookies.get('sdfosdjfijsd')  // undefined

// 获取value为对象的cookie
const obj = { name: 'ryan' }
Cookies.set('user', obj)
// 当value为对象时，获取的cookie需要通过JSON.parse()解析
// 例： console.log(JSON.parse(cookies.get('obj')).age)   
JSON.parse(Cookies.get('user')) 

// 获取所有cookie
Cookies.get()

```

- 删除
```js
// 删除指定名称的cookie
Cookies.remove(name) // value

// 删除带有路径的cookie
Cookies.set(name, value, { path: '' })
Cookies.remove(name, { path: '' })
```


## 案例

```js
import Cookies from 'js-cookie'

const TokenKey = 'qs_token'

export function getToken() {
    return Cookies.get(TokenKey)
}

export function setToken(token) {
    return Cookies.set(TokenKey, token)
}

export function removeToken() {
    return Cookies.remove(TokenKey)
}
```


